#include <stdio.h>
#include <stdbool.h>

#define SET_SIZE 128
#define UI_BITS 32
#define ARRAY_SIZE (SET_SIZE/UI_BITS)

typedef struct {
    unsigned int elems[ARRAY_SIZE];
    int count;
} Set;

void initialize(Set *set);
void insert(Set *set, int elem);
void deleteEl(Set *set, int elem);
bool find(Set set, int elem);
Set setUnion(Set A, Set B);
Set intersection(Set A, Set B);
Set difference(Set A, Set B);
void display(Set *set);

int main() {
    Set A;
    initialize(&A);
    insert(&A, 3);
    insert(&A, 5);
    printf("A = "); display(&A);
    
    Set B;
    initialize(&B);
    insert(&B, 2);
    insert(&B, 4);
    printf("\nB = "); display(&B);
    
    Set C;
    
    C = setUnion(A, B);
    printf("\nUnion of A and B: "); display(&C);
    
    C = intersection(A, B);
    printf("\nIntersection of A and B: "); display(&C);
    
    C = difference(A, B);
    printf("\nDifference of A and B: "); display(&C);
    
    deleteEl(&A, 3);
    printf("\nDeleted 3, A = "); display(&A);
    
    return 0;
}

void initialize(Set *set) {
    for (int i = 0; i < ARRAY_SIZE; i++) {
        set->elems[i] = 0;
    }
    set->count = 0;
}
void insert(Set *set, int elem) {
    if (elem < 0 || elem >= SET_SIZE) return;
    int idx = elem / UI_BITS;
    int pos = elem % UI_BITS;
    if (!(set->elems[idx] & (1 << pos))) {
        set->elems[idx] |= (1 << pos);
        set->count++;
    }
}
void deleteEl(Set *set, int elem) {
    if (elem < 0 || elem >= SET_SIZE) return;
    int idx = elem / UI_BITS;
    int pos = elem % UI_BITS;
    if (set->elems[idx] & (1 << pos)) {
        set->elems[idx] &= ~(1 << pos);
        set->count--;
    }
}
bool find(Set set, int elem) {
    int idx = elem / UI_BITS;
    int pos = elem % UI_BITS;
    return (set.elems[idx] & (1 << pos)) != 0;
}
Set setUnion(Set A, Set B) {
    Set C;
    initialize(&C);
    for (int i = 0; i < ARRAY_SIZE; i++) {
        C.elems[i] = A.elems[i] | B.elems[i];
    }
    C.count = 0;
    for (int i = 0; i < ARRAY_SIZE; i++) {
        unsigned int x = C.elems[i];
        while(x) {
            x &= (x - 1);
            C.count++;
        }
    }
    return C;
}
Set intersection(Set A, Set B) {
    Set C;
    initialize(&C);
    for (int i = 0; i < ARRAY_SIZE; i++) {
        C.elems[i] = A.elems[i] & B.elems[i];
    }
    C.count = 0;
    for (int i = 0; i < ARRAY_SIZE; i++) {
        unsigned int x = C.elems[i];
        while(x) {
            x &= (x - 1);
            C.count++;
        }
    }
    return C;
}
Set difference(Set A, Set B) {
    Set C;
    initialize(&C);
    for (int i = 0; i < ARRAY_SIZE; i++) {
        C.elems[i] = A.elems[i] & ~B.elems[i];
    }
    C.count = 0;
    for (int i = 0; i < ARRAY_SIZE; i++) {
        unsigned int x = C.elems[i];
        while(x) {
            x &= (x - 1);
            C.count++;
        }
    }
    return C;
}
void display(Set *set) {
    int first = 1;
    for (int i = 0; i < SET_SIZE; i++) {
        if (find(*set, i)) {
            if (!first) printf(", ");
            printf("%d", i);
            first = 0;
        }
    }
}